<!DOCTYPE html>  <html> <head>   <title>index.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               index.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>(<span class="keyword">function</span>($) {

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Attach to a global scope</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="keyword">var</span> root = <span class="keyword">this</span>

    , encode = window.encodeURIComponent
    , noop = <span class="function"><span class="keyword">function</span> <span class="title">noop</span><span class="params">()</span> {</span>}
    , slice = Array.prototype.slice

    , graph_url = <span class="string">'https://graph.facebook.com/fql?q='</span>
    , like_url = <span class="string">'//www.facebook.com/plugins/like.php?'</span>
    , stylesheet = [
        <span class="string">'.facebook-like-box_count, .facebook-like-button_count {'</span>
      ,   <span class="string">'overflow: hidden;'</span>
      ,   <span class="string">'position: relative;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like iframe, .facebook-like .facebook-like-counter {'</span>
      ,   <span class="string">'float: left'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-counter {'</span>
      ,   <span class="string">'color: #333;'</span>
      ,   <span class="string">'text-align: center;'</span>
      ,   <span class="string">'white-space: nowrap;'</span>
      ,   <span class="string">'font-family: \'lucida grande\',tahoma,verdana,arial,sans-serif;'</span>
      , <span class="string">'}'</span>
</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Box</p>             </td>             <td class="code">               <div class="highlight"><pre>      , <span class="string">'.facebook-like-box_count {'</span>
      ,   <span class="string">'height: 70px;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-box_count .facebook-like-counter {'</span>
      ,   <span class="string">'left: 1px;'</span>
      ,   <span class="string">'width: 39px;'</span>
      ,   <span class="string">'height: 19px;'</span>
      ,   <span class="string">'padding: 6px 1px 2px 3px;'</span>
      ,   <span class="string">'top: 1px;'</span>
      ,   <span class="string">'font-size: 13px;'</span>
      ,   <span class="string">'background: white;'</span>
      ,   <span class="string">'position: absolute;'</span>
      , <span class="string">'}'</span>
</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Button</p>             </td>             <td class="code">               <div class="highlight"><pre>      , <span class="string">'.facebook-like-button_count {'</span>
      ,   <span class="string">'height: 30px;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-button_count .facebook-like-counter {'</span>
      ,   <span class="string">'border: 1px solid #c1c1c1;'</span>
      ,   <span class="string">'height: 14px;'</span>
      ,   <span class="string">'line-height: 14px;'</span>
      ,   <span class="string">'margin-top: 1px;'</span>
      ,   <span class="string">'margin-left: 6px;'</span>
      ,   <span class="string">'min-width: 15px;'</span>
      ,   <span class="string">'padding: 1px 2px;'</span>
      ,   <span class="string">'font-size: 11px;'</span>
      ,   <span class="string">'position: relative'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-button_count .facebook-like-nub {'</span>
      ,   <span class="string">'height: 0;'</span>
      ,   <span class="string">'left: -5px;'</span>
      ,   <span class="string">'position: absolute;'</span>
      ,   <span class="string">'top: 4px;'</span>
      ,   <span class="string">'width: 5px;'</span>
      ,   <span class="string">'z-index: 2;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-button_count .facebook-like-nub s,'</span>
      , <span class="string">'.facebook-like-button_count .facebook-like-nub i {'</span>
      ,   <span class="string">'border-style: solid;'</span>
      ,   <span class="string">'border-color: transparent #d7d7d7 transparent;'</span>
      ,   <span class="string">'border-width: 4px 5px 4px 0;'</span>
      ,   <span class="string">'display: block;'</span>
      ,   <span class="string">'position: absolute;'</span>
      ,   <span class="string">'left: 0;'</span>
      ,   <span class="string">'top: 0;'</span>
      ,   <span class="string">'height: 0;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-button_count .facebook-like-nub i {'</span>
      ,   <span class="string">'border-right-color: white;'</span>
      ,   <span class="string">'left: 2px;'</span>
      , <span class="string">'}'</span>
</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>General</p>             </td>             <td class="code">               <div class="highlight"><pre>      , <span class="string">'.facebook-like iframe {'</span>
      ,   <span class="string">'border: none;'</span>
      ,   <span class="string">'overflow: hidden;'</span>
      ,   <span class="string">'width: 49px;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-fetch-error iframe {'</span>
      ,   <span class="string">'width: 200px;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-fetch-error .facebook-like-counter {'</span>
      ,   <span class="string">'display: none;'</span>
      , <span class="string">'}'</span>
      , <span class="string">'.facebook-like-nub, .facebook-like-counter {'</span>
      ,   <span class="string">'display: inline-block;'</span>
      , <span class="string">'}'</span>
    ].join(<span class="string">''</span>)

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Store a static reference to the style element once created.</p>             </td>             <td class="code">               <div class="highlight"><pre>    , style_element;

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Default parameters to pass to facebooks button.</p>             </td>             <td class="code">               <div class="highlight"><pre>  root.defaultButtonOptions = {
      send: <span class="string">'false'</span>
    , layout: <span class="string">'button_count'</span>
    , width: <span class="string">'53'</span>
    , show_faces: <span class="string">'false'</span>
    , action: <span class="string">'like'</span>
    , colorscheme: <span class="string">'light'</span>
    , font: <span class="string">'arial'</span>
    , height: <span class="string">'80'</span>
  };
  root.defaultSettings = {
      count: <span class="string">'like'</span>
    , timeout: <span class="number">2000</span>
  };

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Attach the stylesheet to the document.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="function"><span class="keyword">function</span> <span class="title">createStyleElement</span><span class="params">()</span> {</span>
    <span class="keyword">if</span> (style_element) <span class="keyword">return</span>;
    <span class="keyword">if</span> ((style_element = $(<span class="string">'#facebook-like-styles'</span>)[<span class="number">0</span>])) <span class="keyword">return</span>;
    style_element = $(<span class="string">'&lt;style id="facebook-like-styles"&gt;'</span> + stylesheet + <span class="string">'&lt;/style&gt;'</span>).appendTo(<span class="string">'head'</span>)[<span class="number">0</span>];
  }

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Return an URI encoded querystring of the passed object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="function"><span class="keyword">function</span> <span class="title">queryString</span><span class="params">(options)</span> {</span>
    <span class="keyword">var</span> values = [];
    <span class="keyword">for</span> (<span class="keyword">var</span> attribute <span class="keyword">in</span> options) <span class="keyword">if</span> (options.hasOwnProperty(attribute)) {
      values.push(attribute + <span class="string">'='</span> + encode(options[attribute]));
    }
    <span class="keyword">return</span> values.join(<span class="string">'&amp;amp;'</span>);
  }

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h2>LikeButton</h2>             </td>             <td class="code">               <div class="highlight"><pre>
  <span class="function"><span class="keyword">function</span> <span class="title">LikeButton</span><span class="params">(dom, settings)</span> {</span>
    <span class="keyword">this</span>.dom = dom;
    <span class="keyword">this</span>.$dom = $(dom);
    <span class="keyword">this</span>.graph_settings = settings;
    <span class="keyword">this</span>.options = $.extend({}, root.defaultButtonOptions, <span class="keyword">this</span>.parseOptions());
    <span class="keyword">this</span>.iframe_url = like_url + queryString(<span class="keyword">this</span>.options);
  }

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Parse the data options from the dom element and return them.</p>             </td>             <td class="code">               <div class="highlight"><pre>  LikeButton.prototype.parseOptions = <span class="keyword">function</span>() {
    <span class="keyword">var</span> layout = <span class="keyword">this</span>.dom.getAttribute(<span class="string">'data-layout'</span>)
      , options = {};

    options.href = <span class="keyword">this</span>.dom.getAttribute(<span class="string">'data-href'</span>);
    <span class="keyword">if</span> (layout &amp;&amp; <span class="string">'box_count button_count'</span>.indexOf(layout) !== -<span class="number">1</span>) {
      options.layout = layout;
    }
    <span class="keyword">return</span> options;
  };

  LikeButton.prototype.setData = <span class="keyword">function</span>(data) {
    <span class="keyword">this</span>.graph_data = data;
    <span class="keyword">if</span> (!data.error) {
      <span class="keyword">var</span> count_number = data[<span class="keyword">this</span>.graph_settings.count + <span class="string">'_count'</span>];
      <span class="keyword">this</span>.counter = root.formatNumber(count_number);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

  LikeButton.prototype.render = <span class="keyword">function</span>() {
    <span class="keyword">var</span> classes = [<span class="string">'facebook-like-'</span> + <span class="keyword">this</span>.options.layout];
    <span class="keyword">if</span> (<span class="keyword">this</span>.graph_data.error) classes.push(<span class="string">'facebook-fetch-error'</span>);

    <span class="keyword">var</span> content = [
        <span class="string">'&lt;div class="'</span> + classes.join(<span class="string">' '</span>) + <span class="string">'"&gt;'</span>
      ,   <span class="string">'&lt;iframe src='</span> + <span class="keyword">this</span>.iframe_url + <span class="string">' scrolling="no" frameborder="0" allowTransparency="true"&gt;&lt;/iframe&gt;'</span>
      ,   <span class="string">'&lt;div class="facebook-like-counter"&gt;'</span>
      ,     <span class="string">'&lt;div class="facebook-like-number"&gt;'</span> + (<span class="keyword">this</span>.counter ? <span class="keyword">this</span>.counter : <span class="string">''</span>) + <span class="string">'&lt;/div&gt;'</span>
      ,     <span class="string">'&lt;div class="facebook-like-nub"&gt;&lt;s&gt;&lt;/s&gt;&lt;i&gt;&lt;/i&gt;&lt;/div&gt;'</span>
      ,   <span class="string">'&lt;/div&gt;'</span>
      , <span class="string">'&lt;/div&gt;'</span>
    ].join(<span class="string">''</span>);

    <span class="keyword">this</span>.$dom.append(content);
    <span class="keyword">return</span> <span class="keyword">this</span>;
  };

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Fetch the Graph data for all buttons bundled into one JSON request.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="function"><span class="keyword">function</span> <span class="title">fetchGraphData</span><span class="params">(map, settings, cb)</span> {</span>
    <span class="keyword">var</span> urls = [];
    <span class="keyword">for</span> (<span class="keyword">var</span> url <span class="keyword">in</span> map) <span class="keyword">if</span> (map.hasOwnProperty(url)) {
      urls.push(url);
    }

    $.ajax({
        url: root.createQuery(urls)
</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>@TODO for some reason this is required for IE.</p>             </td>             <td class="code">               <div class="highlight"><pre>      , dataType: <span class="string">'jsonp'</span>
      , timeout: settings.timeout
    })
    .done(<span class="keyword">function</span>(json) {
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = json.data.length; i &lt; l; i++) {
        <span class="keyword">var</span> data = json.data[i]
          , buttons = map[data.url];

        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; buttons.length; j++) {
          buttons[j]
            .setData(data)
            .render();
        }
      }
      root.success.apply(<span class="keyword">this</span>, slice.call(arguments));
    })
    .fail(<span class="keyword">function</span>() {
      <span class="keyword">for</span> (<span class="keyword">var</span> url <span class="keyword">in</span> map) <span class="keyword">if</span> (map.hasOwnProperty(url)) {
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = map[url].length; i &lt; l; i++) {
          map[url][i]
            .setData({ error: <span class="literal">true</span> })
            .render();
        }
      }
      root.error.apply(<span class="keyword">this</span>, slice.call(arguments));
    })
    .always(<span class="keyword">typeof</span> cb === <span class="string">'function'</span> ? cb : <span class="literal">undefined</span>);
  }

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>#formatNumber()</h3>

<p>Format a number according to show the Facebook button displays them,
eg. 9100 -> 9.1k</p>             </td>             <td class="code">               <div class="highlight"><pre>
  root.formatNumber = <span class="keyword">function</span>(number) {
    number = number + <span class="string">''</span>;
    <span class="keyword">if</span> (number &lt; <span class="number">1000</span>) {
      <span class="keyword">return</span> number; <span class="comment">// 999</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (number &lt; <span class="number">10000</span>) {
      number = (number / <span class="number">1000</span>).toFixed(<span class="number">1</span>) + <span class="string">'k'</span>;
      <span class="keyword">return</span> number.replace(<span class="string">'.0'</span>, <span class="string">''</span>); <span class="comment">// 9.1k</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (number &lt; <span class="number">1000000</span>) {
      <span class="keyword">return</span> (number / <span class="number">1000</span>).toFixed(<span class="number">0</span>) + <span class="string">'k'</span>; <span class="comment">// 10k</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (number &lt; <span class="number">10000000</span>) {
      number = (number / <span class="number">1000</span> / <span class="number">1000</span>).toFixed(<span class="number">1</span>) + <span class="string">'m'</span>; <span class="comment">// 1.1m</span>
      <span class="keyword">return</span> number.replace(<span class="string">'.0'</span>, <span class="string">''</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (number &lt; <span class="number">100000000</span>) {
      <span class="keyword">return</span> (number / <span class="number">1000</span> / <span class="number">1000</span>).toFixed(<span class="number">0</span>) + <span class="string">'m'</span>; <span class="comment">// 11m</span>
    }
  };

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>#createQuery()</h3>

<p>Returns the Graph query url for this array of urls.</p>             </td>             <td class="code">               <div class="highlight"><pre>
  root.createQuery = <span class="keyword">function</span>(urls) {
    <span class="keyword">return</span> graph_url +
      encode(<span class="string">'SELECT url, share_count, like_count, comment_count, '</span> +
        <span class="string">'total_count, commentsbox_count, click_count FROM link_stat '</span> +
        <span class="string">'WHERE url IN (\''</span> + urls.join(<span class="string">'\', \''</span>) + <span class="string">'\')'</span>);
  };


</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>#succes()</h3>

<p>Global success callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>
  root.success = noop;

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>#error()</h3>

<p>Global error callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>
  root.error = noop;

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>#parse()</h3>

<p>Parse the dom for facebook like buttons.</p>

<p>Options:</p>

<ul>
<li>$el: (optional) Elements to parse. Defaults to .facebook-like selector</li>
<li>settings: (optional) Object containing graph settings.
<ul><li>count: share|like|comment|total|commentsbox|click. Defaults to like.</li></ul></li>
<li>cb: (optional) Callback function. This will be called with the $.ajax
response</li>
</ul>

<p>Usage:</p>

<pre><code>FBLike.parse();
FBLike.parse($('.fb-like'), { count: 'total' });
FBLike.parse(function(data, textStatus) { $frame.fadeIn(); });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>
  root.parse = <span class="keyword">function</span>($el, settings, cb) {
    createStyleElement();
    <span class="keyword">if</span> ($el &amp;&amp; $el.nodeName) $el = $($el);
    <span class="keyword">if</span> (!($el <span class="keyword">instanceof</span> jQuery)) {
      <span class="keyword">if</span> ($.isPlainObject) settings = $el;
      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> $el === <span class="string">'function'</span>) cb = $el;
      $el = $(<span class="string">'.facebook-like'</span>);
    }
    <span class="keyword">if</span> (!$.isPlainObject(settings)) {
      <span class="keyword">if</span> (<span class="keyword">typeof</span> settings === <span class="string">'function'</span>) cb = settings;
      settings = root.defaultSettings;
    }

    <span class="keyword">var</span> map = {};
    $el.each(<span class="keyword">function</span>() {
      <span class="keyword">if</span> (!$.data(<span class="keyword">this</span>, <span class="string">'fblike'</span>)) {
        <span class="keyword">var</span> href = <span class="keyword">this</span>.getAttribute(<span class="string">'data-href'</span>)
          , button = <span class="keyword">new</span> LikeButton(<span class="keyword">this</span>, settings);

        <span class="keyword">if</span> (!map[href]) map[href] = [];
        map[href].push(button);
        $.data(<span class="keyword">this</span>, <span class="string">'fblike'</span>, button);
      }
    });

    fetchGraphData(map, settings, cb);
  };

}).call((<span class="keyword">this</span>.FBLike = {}), jQuery);

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 